<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>依頼主登録 - わくわくギルド</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>⚔️ わくわくギルド</h1>
      <nav>
        <a href="index.html">クエスト掲示板</a>
        <a href="ranking.html">ランキング</a>
        <a href="member.html">メンバー登録</a>
        <a href="client.html">依頼主登録</a>
        <a href="mypage.html">マイページ</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="form-section">
      <h2>📋 依頼主登録</h2>
      <p>地域のギルドメンバーに仕事を依頼しませんか？</p>

      <form id="clientForm" onsubmit="submitClientForm(event)">
        <div class="form-group">
          <label for="clientName">依頼主名（個人名または団体名） <span class="required">*</span></label>
          <input type="text" id="clientName" name="clientName" required>
          <small>個人の方は氏名、団体の方は団体名を入力してください</small>
        </div>

        <div class="form-group">
          <label for="email">メールアドレス <span class="required">*</span></label>
          <input type="email" id="email" name="email" required>
        </div>

        <div class="form-group">
          <label for="phone">電話番号 <span class="required">*</span></label>
          <input type="tel" id="phone" name="phone" required>
        </div>

        <div class="form-group">
          <label for="address">住所 <span class="required">*</span></label>
          <input type="text" id="address" name="address" required>
          <small>クエスト実施場所が異なる場合は、クエスト投稿時に別途指定できます</small>
        </div>

        <div class="form-group">
          <label for="clientType">依頼主種別 <span class="required">*</span></label>
          <select id="clientType" name="clientType" required>
            <option value="">選択してください</option>
            <option value="個人">個人</option>
            <option value="自治会">自治会</option>
            <option value="企業">企業</option>
            <option value="NPO">NPO・団体</option>
            <option value="その他">その他</option>
          </select>
        </div>

        <div class="form-group">
          <label for="remarks">備考・その他</label>
          <textarea id="remarks" name="remarks" rows="4" placeholder="特記事項があればご記入ください"></textarea>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" name="agree" required>
            <a href="#" onclick="showTerms(); return false;">利用規約</a>および<a href="#" onclick="showPrivacy(); return false;">プライバシーポリシー</a>に同意します
          </label>
        </div>

        <button type="submit" class="btn-primary" id="submitBtn">登録申請する</button>
      </form>

      <div class="info-box">
        <h3>💡 依頼主登録について</h3>
        <ul>
          <li>登録申請後、事務局が審査を行います（通常2-3営業日）</li>
          <li>承認後、クエスト投稿が可能になります</li>
          <li>クエスト承認時に報酬相当額を事務局にお預けいただきます</li>
          <li>クエスト完了後、事務局からギルドメンバーへ報酬を支払います</li>
        </ul>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2026 総社市ギルド事務局 | わくわくギルドプロジェクト</p>
  </footer>

  <script src="js/config.js"></script>
  <script>
    async function submitClientForm(event) {
      event.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = '送信中...';
      
      const formData = new FormData(event.target);
      
      const clientData = {
        clientName: formData.get('clientName'),
        email: formData.get('email'),
        phone: formData.get('phone'),
        address: formData.get('address'),
        clientType: formData.get('clientType'),
        remarks: formData.get('remarks')
      };

      try {
        const response = await fetch(GAS_WEB_APP_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            action: 'registerClient',
            data: clientData
          })
        });

        const result = await response.json();
        
        if (result.success) {
          alert(`✅ 登録申請を受け付けました！\n\n依頼主ID: ${result.clientId}\n\n事務局の審査をお待ちください。\n審査結果はメールでお知らせします。\n\n※依頼主IDは大切に保管してください。`);
          event.target.reset();
        } else {
          alert('❌ 登録に失敗しました\n\n' + (result.message || 'エラーが発生しました'));
        }
      } catch (error) {
        console.error('登録エラー:', error);
        alert('❌ 登録処理中にエラーが発生しました\n\nネットワーク接続を確認して、もう一度お試しください。');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = '登録申請する';
      }
    }

    function showTerms() {
      alert('【利用規約】\n\n1. 本サービスは総社市が運営するスキルマッチングプラットフォームです\n2. 登録情報は適切に管理されます\n3. クエスト投稿時は正確な情報を記載してください\n4. 報酬は事前に事務局へお預けいただきます\n5. 不正行為が発覚した場合は登録を抹消します\n\n※詳細は後日Webページで公開予定');
    }

    function showPrivacy() {
      alert('【プライバシーポリシー】\n\n1. 個人情報は本サービスの運営目的のみに使用します\n2. 第三者への提供は行いません（法令に基づく場合を除く）\n3. 情報の管理には万全を期します\n\n※詳細は後日Webページで公開予定');
    }
  </script>
</body>
</html>
