<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ” ç®¡ç†ç”»é¢ - ã‚ãã‚ãã‚®ãƒ«ãƒ‰</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>âš”ï¸ ã‚ãã‚ãã‚®ãƒ«ãƒ‰</h1>
      <nav>
        <a href="index.html">ã‚¯ã‚¨ã‚¹ãƒˆæ²ç¤ºæ¿</a>
        <a href="ranking.html">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
        <a href="member.html">ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²</a>
        <a href="client.html">ä¾é ¼ä¸»ç™»éŒ²</a>
        <a href="mypage.html">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
      </nav>
    </div>
  </header>

  <main>
    <div class="container admin-section">
      <div class="hero">
        <h2>ğŸ” ç®¡ç†ç”»é¢</h2>
        <p>ç·ç¤¾å¸‚ã‚®ãƒ«ãƒ‰äº‹å‹™å±€å°‚ç”¨ãƒšãƒ¼ã‚¸</p>
      </div>

      <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div id="loginSection" class="admin-login">
        <h3>ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h3>
        <form id="loginForm">
          <div class="form-group">
            <label>ç®¡ç†è€…ID</label>
            <input type="text" id="adminId" name="adminId" required>
          </div>
          <div class="form-group">
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="password" id="password" name="password" required>
          </div>
          <button type="submit" class="btn-primary">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </form>
        <p class="note">â€»ãƒ‡ãƒ¢ç‰ˆ: ã©ã‚“ãªID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½ã§ã™</p>
      </div>

      <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
      <div id="dashboardContent" style="display: none;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
          <h3>ğŸ“Š çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
          <button onclick="logout()" class="btn-secondary">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>
        
        <div class="dashboard-stats">
          <div class="stat-card">
            <h3>â³ å¯©æŸ»å¾…ã¡</h3>
            <div class="stat-number" id="pendingTotal">0</div>
            <small>
              ãƒ¡ãƒ³ãƒãƒ¼: <span id="pendingMembers">0</span> |
              ä¾é ¼ä¸»: <span id="pendingClients">0</span> |
              ã‚¯ã‚¨ã‚¹ãƒˆ: <span id="pendingQuests">0</span>
            </small>
          </div>
          
          <div class="stat-card">
            <h3>âš™ï¸ é€²è¡Œä¸­</h3>
            <div class="stat-number" id="inProgress">0</div>
            <small>ç¾åœ¨é€²è¡Œä¸­ã®ã‚¯ã‚¨ã‚¹ãƒˆ</small>
          </div>
          
          <div class="stat-card">
            <h3>âœ… ä»Šæœˆå®Œäº†</h3>
            <div class="stat-number" id="completed">0</div>
            <small>ä»Šæœˆå®Œäº†ã—ãŸã‚¯ã‚¨ã‚¹ãƒˆ</small>
          </div>
          
          <div class="stat-card">
            <h3>ğŸ’° é ã‹ã‚Šé‡‘</h3>
            <div class="stat-number" id="deposit">Â¥0</div>
            <small>é€²è¡Œä¸­ã‚¯ã‚¨ã‚¹ãƒˆã®å ±é…¬ç·é¡</small>
          </div>
        </div>

        <!-- ã‚¿ãƒ– -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="approval">å¯©æŸ»ç®¡ç†</button>
          <button class="tab-btn" data-tab="quests">ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†</button>
          <button class="tab-btn" data-tab="members">ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</button>
          <button class="tab-btn" data-tab="clients">ä¾é ¼ä¸»ç®¡ç†</button>
        </div>

        <!-- å¯©æŸ»ç®¡ç†ã‚¿ãƒ– -->
        <div id="approvalTab" class="tab-content">
          <h4>â³ å¯©æŸ»å¾…ã¡ãƒªã‚¹ãƒˆ</h4>
          
          <h5 style="margin-top: 2rem;">ãƒ¡ãƒ³ãƒãƒ¼ç”³è«‹</h5>
          <div id="pendingMembersList"></div>
          
          <h5 style="margin-top: 2rem;">ä¾é ¼ä¸»ç”³è«‹</h5>
          <div id="pendingClientsList"></div>
          
          <h5 style="margin-top: 2rem;">ã‚¯ã‚¨ã‚¹ãƒˆç”³è«‹</h5>
          <div id="pendingQuestsList"></div>
        </div>

        <!-- ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†ã‚¿ãƒ– -->
        <div id="questsTab" class="tab-content" style="display: none;">
          <h4>ğŸ“‹ å…¨ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†</h4>
          <div id="allQuestsList">
            <p class="no-data">æº–å‚™ä¸­</p>
          </div>
        </div>

        <!-- ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ã‚¿ãƒ– -->
        <div id="membersTab" class="tab-content" style="display: none;">
          <h4>ğŸ‘¥ å…¨ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</h4>
          <div id="allMembersList">
            <p class="no-data">æº–å‚™ä¸­</p>
          </div>
        </div>

        <!-- ä¾é ¼ä¸»ç®¡ç†ã‚¿ãƒ– -->
        <div id="clientsTab" class="tab-content" style="display: none;">
          <h4>ğŸ“ å…¨ä¾é ¼ä¸»ç®¡ç†</h4>
          <div id="allClientsList">
            <p class="no-data">æº–å‚™ä¸­</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>Â© 2026 ç·ç¤¾å¸‚ã‚®ãƒ«ãƒ‰äº‹å‹™å±€ | ã‚ãã‚ãã‚®ãƒ«ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</p>
  </footer>

  <script src="js/config.js"></script>
  <script>
    let isLoggedIn = false;

    function initializePage() {
      // ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã®å­˜åœ¨ç¢ºèª
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        console.log('âœ… loginForm ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ');
        setupLogin();
      } else {
        console.error('âŒ loginForm ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
      }
    }

    /**
     * ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
     */
    function setupLogin() {
      const loginForm = document.getElementById('loginForm');
      
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const adminId = document.getElementById('adminId').value;
        const password = document.getElementById('password').value;
        
        // ãƒ‡ãƒ¢ç‰ˆ: ã©ã‚“ãªID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
        if (adminId && password) {
          console.log('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ');
          isLoggedIn = true;
          Storage.saveLogin('admin', adminId, { name: 'ç®¡ç†è€…' });
          showDashboard();
          loadAllData();
        } else {
          alert('IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        }
      });
    }

    /**
     * ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
     */
    function showDashboard() {
      const loginSection = document.getElementById('loginSection');
      const dashboardContent = document.getElementById('dashboardContent');
      
      if (loginSection) loginSection.style.display = 'none';
      if (dashboardContent) {
        dashboardContent.style.display = 'block';
        setupTabs();
      }
    }

    /**
     * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
     */
    function logout() {
      if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        Storage.clearLogin();
        location.reload();
      }
    }

    /**
     * å…¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
     */
    async function loadAllData() {
      await loadStats();
      await loadApprovalData();
    }

    /**
     * çµ±è¨ˆæƒ…å ±èª­ã¿è¾¼ã¿
     */
    async function loadStats() {
      try {
        const stats = await API.get('getAdminStats');
        
        document.getElementById('pendingTotal').textContent = stats.pendingTotal || 0;
        document.getElementById('pendingMembers').textContent = stats.pendingMembers || 0;
        document.getElementById('pendingClients').textContent = stats.pendingClients || 0;
        document.getElementById('pendingQuests').textContent = stats.pendingQuests || 0;
        document.getElementById('inProgress').textContent = stats.inProgress || 0;
        document.getElementById('completed').textContent = stats.completed || 0;
        document.getElementById('deposit').textContent = Utils.formatCurrency(stats.deposit || 0);
      } catch (error) {
        console.error('çµ±è¨ˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    /**
     * å¯©æŸ»ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
     */
    async function loadApprovalData() {
      try {
        const data = await API.get('getApprovalData');
        
        displayPendingMembers(data.members || []);
        displayPendingClients(data.clients || []);
        displayPendingQuests(data.quests || []);
      } catch (error) {
        console.error('å¯©æŸ»ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    /**
     * å¯©æŸ»å¾…ã¡ãƒ¡ãƒ³ãƒãƒ¼è¡¨ç¤º
     */
    function displayPendingMembers(members) {
      const container = document.getElementById('pendingMembersList');
      if (!container) return;
      
      if (members.length === 0) {
        container.innerHTML = '<p class="no-data">å¯©æŸ»å¾…ã¡ã®ãƒ¡ãƒ³ãƒãƒ¼ã¯ã„ã¾ã›ã‚“</p>';
        return;
      }
      
      const table = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </th>
              <th>æ°å</th>
              <th>ãƒ¡ãƒ¼ãƒ«</th>
              <th>ç™»éŒ²æ—¥</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            ${members.map(m => `
              <tr>
                <td>${m.id}</td>
                <td>${m.nickname}</td>
                <td>${m.name}</td>
                <td>${m.email}</td>
                <td>${Utils.formatDate(m.registeredDate)}</td>
                <td>
                  <button class="btn-approve" onclick="approveMember('${m.id}')">æ‰¿èª</button>
                  <button class="btn-reject" onclick="rejectMember('${m.id}')">å´ä¸‹</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      container.innerHTML = table;
    }

    /**
     * å¯©æŸ»å¾…ã¡ä¾é ¼ä¸»è¡¨ç¤º
     */
    function displayPendingClients(clients) {
      const container = document.getElementById('pendingClientsList');
      if (!container) return;
      
      if (clients.length === 0) {
        container.innerHTML = '<p class="no-data">å¯©æŸ»å¾…ã¡ã®ä¾é ¼ä¸»ã¯ã„ã¾ã›ã‚“</p>';
        return;
      }
      
      const table = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>ä¾é ¼ä¸»å</th>
              <th>ç¨®åˆ¥</th>
              <th>ãƒ¡ãƒ¼ãƒ«</th>
              <th>ç™»éŒ²æ—¥</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            ${clients.map(c => `
              <tr>
                <td>${c.id}</td>
                <td>${c.name}</td>
                <td>${c.type}</td>
                <td>${c.email}</td>
                <td>${Utils.formatDate(c.registeredDate)}</td>
                <td>
                  <button class="btn-approve" onclick="approveClient('${c.id}')">æ‰¿èª</button>
                  <button class="btn-reject" onclick="rejectClient('${c.id}')">å´ä¸‹</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      container.innerHTML = table;
    }

    /**
     * å¯©æŸ»å¾…ã¡ã‚¯ã‚¨ã‚¹ãƒˆè¡¨ç¤º
     */
    function displayPendingQuests(quests) {
      const container = document.getElementById('pendingQuestsList');
      if (!container) return;
      
      if (quests.length === 0) {
        container.innerHTML = '<p class="no-data">å¯©æŸ»å¾…ã¡ã®ã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }
      
      const table = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
              <th>ä¾é ¼ä¸»ID</th>
              <th>å ±é…¬</th>
              <th>ç™»éŒ²æ—¥</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            ${quests.map(q => `
              <tr>
                <td>${q.id}</td>
                <td>${q.title}</td>
                <td>${q.clientId}</td>
                <td>${Utils.formatCurrency(q.reward)}</td>
                <td>${Utils.formatDate(q.registeredDate)}</td>
                <td>
                  <button class="btn-approve" onclick="approveQuest('${q.id}')">æ‰¿èª</button>
                  <button class="btn-reject" onclick="rejectQuest('${q.id}')">å´ä¸‹</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
      
      container.innerHTML = table;
    }

    /**
     * ãƒ¡ãƒ³ãƒãƒ¼æ‰¿èª
     */
    async function approveMember(id) {
      if (!confirm(`ãƒ¡ãƒ³ãƒãƒ¼ ${id} ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)) return;
      
      try {
        const result = await API.post('approve', { type: 'member', id: id });
        
        if (result.success) {
          Notification.success('ãƒ¡ãƒ³ãƒãƒ¼ã‚’æ‰¿èªã—ã¾ã—ãŸ');
          loadAllData();
        } else {
          Notification.error('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
      } catch (error) {
        Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    /**
     * ãƒ¡ãƒ³ãƒãƒ¼å´ä¸‹
     */
    async function rejectMember(id) {
      const reason = prompt('å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
      if (!reason) return;
      
      try {
        const result = await API.post('reject', { type: 'member', id: id, reason: reason });
        
        if (result.success) {
          Notification.success('ãƒ¡ãƒ³ãƒãƒ¼ã‚’å´ä¸‹ã—ã¾ã—ãŸ');
          loadAllData();
        } else {
          Notification.error('å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
      } catch (error) {
        Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    /**
     * ä¾é ¼ä¸»æ‰¿èª
     */
    async function approveClient(id) {
      if (!confirm(`ä¾é ¼ä¸» ${id} ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)) return;
      
      try {
        const result = await API.post('approve', { type: 'client', id: id });
        
        if (result.success) {
          Notification.success('ä¾é ¼ä¸»ã‚’æ‰¿èªã—ã¾ã—ãŸ');
          loadAllData();
        } else {
          Notification.error('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
      } catch (error) {
        Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    /**
     * ä¾é ¼ä¸»å´ä¸‹
     */
    async function rejectClient(id) {
      const reason = prompt('å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
      if (!reason) return;
      
      try {
        const result = await API.post('reject', { type: 'client', id: id, reason: reason });
        
        if (result.success) {
          Notification.success('ä¾é ¼ä¸»ã‚’å´ä¸‹ã—ã¾ã—ãŸ');
          loadAllData();
        } else {
          Notification.error('å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
      } catch (error) {
        Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    /**
     * ã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èª
     */
    async function approveQuest(id) {
      if (!confirm(`ã‚¯ã‚¨ã‚¹ãƒˆ ${id} ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)) return;
      
      try {
        const result = await API.post('approve', { type: 'quest', id: id });
        
        if (result.success) {
          Notification.success('ã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‰¿èªã—ã¾ã—ãŸ');
          loadAllData();
        } else {
          Notification.error('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
      } catch (error) {
        Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    /**
     * ã‚¯ã‚¨ã‚¹ãƒˆå´ä¸‹
     */
    async function rejectQuest(id) {
      const reason = prompt('å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
      if (!reason) return;
      
      try {
        const result = await API.post('reject', { type: 'quest', id: id, reason: reason });
        
        if (result.success) {
          Notification.success('ã‚¯ã‚¨ã‚¹ãƒˆã‚’å´ä¸‹ã—ã¾ã—ãŸ');
          loadAllData();
        } else {
          Notification.error('å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
        }
      } catch (error) {
        Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
      }
    }

    /**
     * ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
     */
    function setupTabs() {
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const tab = btn.dataset.tab;
          
          // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡ã‚Šæ›¿ãˆ
          document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          
          // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
          document.querySelectorAll('.tab-content').forEach(content => {
            content.style.display = 'none';
          });
          const tabContent = document.getElementById(`${tab}Tab`);
          if (tabContent) {
            tabContent.style.display = 'block';
          }
        });
      });
    }
  </script>
</body>
</html>