<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº‹å‹™å±€ç®¡ç†ç”»é¢ - ã‚ãã‚ãã‚®ãƒ«ãƒ‰</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>âš”ï¸ ã‚ãã‚ãã‚®ãƒ«ãƒ‰ - äº‹å‹™å±€</h1>
      <nav>
        <a href="admin.html">ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</a>
        <a href="index.html" target="_blank">å…¬é–‹ãƒšãƒ¼ã‚¸ã¸</a>
        <a href="#" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="admin-section">
      <h2>ğŸ›¡ï¸ äº‹å‹™å±€ç®¡ç†ç”»é¢</h2>
      
      <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
      <div class="admin-login" id="adminLogin">
        <h3>ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h3>
        <form onsubmit="handleAdminLogin(event)">
          <div class="form-group">
            <label>ç®¡ç†è€…ID</label>
            <input type="text" id="adminId" required placeholder="admin">
          </div>
          <div class="form-group">
            <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
            <input type="password" id="adminPassword" required placeholder="password">
          </div>
          <button type="submit" class="btn-primary">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </form>
        <p class="note">â€»ãƒ‡ãƒ¢ç‰ˆ: ã©ã‚“ãªID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½</p>
      </div>

      <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
      <div id="adminLoading" class="loading" style="display: none;">
        <p>ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>
      </div>

      <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ -->
      <div class="admin-dashboard" id="adminDashboard" style="display: none;">
        <div class="dashboard-stats">
          <div class="stat-card">
            <h3>ğŸ“‹ å¯©æŸ»å¾…ã¡</h3>
            <p class="stat-number" id="statPending">0ä»¶</p>
            <small id="statPendingDetail">ãƒ¡ãƒ³ãƒãƒ¼: 0ä»¶ / ä¾é ¼ä¸»: 0ä»¶ / ã‚¯ã‚¨ã‚¹ãƒˆ: 0ä»¶</small>
          </div>
          <div class="stat-card">
            <h3>ğŸ”„ é€²è¡Œä¸­ã‚¯ã‚¨ã‚¹ãƒˆ</h3>
            <p class="stat-number" id="statInProgress">0ä»¶</p>
            <small>å—æ³¨æ¸ˆãƒ»é€²è¡Œä¸­ã®æ¡ˆä»¶</small>
          </div>
          <div class="stat-card">
            <h3>âœ… å®Œäº†ã‚¯ã‚¨ã‚¹ãƒˆ</h3>
            <p class="stat-number" id="statCompleted">0ä»¶</p>
            <small>ä»Šæœˆã®å®Œäº†æ•°</small>
          </div>
          <div class="stat-card">
            <h3>ğŸ’° é ã‹ã‚Šé‡‘</h3>
            <p class="stat-number" id="statDeposit">Â¥0</p>
            <small>æœªæ‰•ã„å ±é…¬ç·é¡</small>
          </div>
        </div>

        <div class="tabs">
          <button class="tab-btn active" onclick="showAdminTab('approval')">å¯©æŸ»å¾…ã¡</button>
          <button class="tab-btn" onclick="showAdminTab('quests')">ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†</button>
          <button class="tab-btn" onclick="showAdminTab('members')">ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</button>
          <button class="tab-btn" onclick="showAdminTab('clients')">ä¾é ¼ä¸»ç®¡ç†</button>
          <button class="tab-btn" onclick="showAdminTab('payment')">å ±é…¬æ”¯æ‰•ç®¡ç†</button>
          <button class="tab-btn" onclick="showAdminTab('reports')">å ±å‘Šãƒ»å•é¡Œå¯¾å¿œ</button>
        </div>

        <!-- å¯©æŸ»å¾…ã¡ã‚¿ãƒ– -->
        <div id="approvalTab" class="tab-content">
          <h3>ğŸ“‹ å¯©æŸ»å¾…ã¡ä¸€è¦§</h3>
          
          <h4>ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²ç”³è«‹</h4>
          <div id="memberApprovalList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>

          <h4>ä¾é ¼ä¸»ç™»éŒ²ç”³è«‹</h4>
          <div id="clientApprovalList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>

          <h4>ã‚¯ã‚¨ã‚¹ãƒˆæŠ•ç¨¿å¯©æŸ»</h4>
          <div id="questApprovalList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>

        <!-- ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†ã‚¿ãƒ– -->
        <div id="questsTab" class="tab-content" style="display: none;">
          <h3>ğŸ—ºï¸ ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†</h3>
          <div class="filter-bar">
            <select id="questStatusFilter">
              <option value="">ã™ã¹ã¦</option>
              <option value="å‹Ÿé›†ä¸­">å‹Ÿé›†ä¸­</option>
              <option value="å—æ³¨æ¸ˆ">å—æ³¨æ¸ˆ</option>
              <option value="å®Œäº†">å®Œäº†</option>
              <option value="ã‚­ãƒ£ãƒ³ã‚»ãƒ«">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</option>
            </select>
            <input type="text" id="questSearchInput" placeholder="ã‚¯ã‚¨ã‚¹ãƒˆåã§æ¤œç´¢...">
            <button onclick="filterQuests()">çµã‚Šè¾¼ã¿</button>
            <button onclick="resetQuestFilter()" class="btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <div id="questManagementList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>

        <!-- ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†ã‚¿ãƒ– -->
        <div id="membersTab" class="tab-content" style="display: none;">
          <h3>ğŸ‘¥ ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</h3>
          <div class="filter-bar">
            <select id="memberStatusFilter">
              <option value="">ã™ã¹ã¦</option>
              <option value="æ‰¿èª">æ´»å‹•ä¸­</option>
              <option value="åœæ­¢">åœæ­¢ä¸­</option>
            </select>
            <input type="text" id="memberSearchInput" placeholder="ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§æ¤œç´¢...">
            <button onclick="filterMembers()">çµã‚Šè¾¼ã¿</button>
            <button onclick="resetMemberFilter()" class="btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <div id="memberManagementList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>

        <!-- ä¾é ¼ä¸»ç®¡ç†ã‚¿ãƒ– -->
        <div id="clientsTab" class="tab-content" style="display: none;">
          <h3>ğŸ“‹ ä¾é ¼ä¸»ç®¡ç†</h3>
          <div class="filter-bar">
            <input type="text" id="clientSearchInput" placeholder="ä¾é ¼ä¸»åã§æ¤œç´¢...">
            <button onclick="filterClients()">çµã‚Šè¾¼ã¿</button>
            <button onclick="resetClientFilter()" class="btn-secondary">ãƒªã‚»ãƒƒãƒˆ</button>
          </div>
          <div id="clientManagementList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>

        <!-- å ±é…¬æ”¯æ‰•ç®¡ç†ã‚¿ãƒ– -->
        <div id="paymentTab" class="tab-content" style="display: none;">
          <h3>ğŸ’° å ±é…¬æ”¯æ‰•ç®¡ç†</h3>
          
          <h4>æ”¯æ‰•äºˆå®š</h4>
          <div id="paymentPendingList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>

          <h4>æ”¯æ‰•å®Œäº†</h4>
          <div id="paymentCompletedList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>

        <!-- å ±å‘Šãƒ»å•é¡Œå¯¾å¿œã‚¿ãƒ– -->
        <div id="reportsTab" class="tab-content" style="display: none;">
          <h3>âš ï¸ å ±å‘Šãƒ»å•é¡Œå¯¾å¿œ</h3>
          <div id="reportsList">
            <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2026 ç·ç¤¾å¸‚ã‚®ãƒ«ãƒ‰äº‹å‹™å±€ | ã‚ãã‚ãã‚®ãƒ«ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</p>
  </footer>

<!-- admin.html ã®ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰éƒ¨åˆ† -->
<div id="dashboardContent" style="display: none;">
  <h3>ğŸ“Š çµ±è¨ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h3>
  
  <div class="dashboard-stats">
    <div class="stat-card">
      <h3>â³ å¯©æŸ»å¾…ã¡</h3>
      <div class="stat-number" id="pendingTotal">0</div>
      <small>
        ãƒ¡ãƒ³ãƒãƒ¼: <span id="pendingMembers">0</span> |
        ä¾é ¼ä¸»: <span id="pendingClients">0</span> |
        ã‚¯ã‚¨ã‚¹ãƒˆ: <span id="pendingQuests">0</span>
      </small>
    </div>
    
    <div class="stat-card">
      <h3>âš™ï¸ é€²è¡Œä¸­</h3>
      <div class="stat-number" id="inProgress">0</div>
      <small>ç¾åœ¨é€²è¡Œä¸­ã®ã‚¯ã‚¨ã‚¹ãƒˆ</small>
    </div>
    
    <div class="stat-card">
      <h3>âœ… ä»Šæœˆå®Œäº†</h3>
      <div class="stat-number" id="completed">0</div>
      <small>ä»Šæœˆå®Œäº†ã—ãŸã‚¯ã‚¨ã‚¹ãƒˆ</small>
    </div>
    
    <div class="stat-card">
      <h3>ğŸ’° é ã‹ã‚Šé‡‘</h3>
      <div class="stat-number" id="deposit">Â¥0</div>
      <small>é€²è¡Œä¸­ã‚¯ã‚¨ã‚¹ãƒˆã®å ±é…¬ç·é¡</small>
    </div>
  </div>

  <!-- ã‚¿ãƒ– -->
  <div class="tabs">
    <button class="tab-btn active" data-tab="approval">å¯©æŸ»ç®¡ç†</button>
    <button class="tab-btn" data-tab="quests">ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†</button>
    <button class="tab-btn" data-tab="members">ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</button>
    <button class="tab-btn" data-tab="clients">ä¾é ¼ä¸»ç®¡ç†</button>
    <button class="tab-btn" data-tab="payment">å ±é…¬ç®¡ç†</button>
    <button class="tab-btn" data-tab="reports">å ±å‘Šç®¡ç†</button>
  </div>

  <!-- å¯©æŸ»ç®¡ç†ã‚¿ãƒ– -->
  <div id="approvalTab" class="tab-content">
    <h4>â³ å¯©æŸ»å¾…ã¡ãƒªã‚¹ãƒˆ</h4>
    
    <h5>ãƒ¡ãƒ³ãƒãƒ¼ç”³è«‹</h5>
    <div id="pendingMembersList"></div>
    
    <h5>ä¾é ¼ä¸»ç”³è«‹</h5>
    <div id="pendingClientsList"></div>
    
    <h5>ã‚¯ã‚¨ã‚¹ãƒˆç”³è«‹</h5>
    <div id="pendingQuestsList"></div>
  </div>

  <!-- ãã®ä»–ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <div id="questsTab" class="tab-content" style="display: none;">
    <h4>ğŸ“‹ å…¨ã‚¯ã‚¨ã‚¹ãƒˆç®¡ç†</h4>
    <div id="allQuestsList"></div>
  </div>

  <div id="membersTab" class="tab-content" style="display: none;">
    <h4>ğŸ‘¥ å…¨ãƒ¡ãƒ³ãƒãƒ¼ç®¡ç†</h4>
    <div id="allMembersList"></div>
  </div>

  <div id="clientsTab" class="tab-content" style="display: none;">
    <h4>ğŸ“ å…¨ä¾é ¼ä¸»ç®¡ç†</h4>
    <div id="allClientsList"></div>
  </div>

  <div id="paymentTab" class="tab-content" style="display: none;">
    <h4>ğŸ’° å ±é…¬ç®¡ç†</h4>
    <div id="paymentList"></div>
  </div>

  <div id="reportsTab" class="tab-content" style="display: none;">
    <h4>ğŸ“¢ å ±å‘Šç®¡ç†</h4>
    <div id="reportsList"></div>
  </div>
</div>

<script src="js/config.js"></script>
<script>
  let isLoggedIn = false;

  function initializePage() {
    setupLogin();
  }

  /**
   * ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
   */
  function setupLogin() {
    const loginForm = document.getElementById('loginForm');
    
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const adminId = document.getElementById('adminId').value;
      const password = document.getElementById('password').value;
      
      // ãƒ‡ãƒ¢ç‰ˆ: ã©ã‚“ãªID/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½
      if (adminId && password) {
        isLoggedIn = true;
        Storage.saveLogin('admin', adminId, { name: 'ç®¡ç†è€…' });
        showDashboard();
        loadAllData();
      } else {
        alert('IDã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      }
    });
  }

  /**
   * ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º
   */
  function showDashboard() {
    document.getElementById('loginSection').style.display = 'none';
    document.getElementById('dashboardContent').style.display = 'block';
    setupTabs();
  }

  /**
   * å…¨ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
   */
  async function loadAllData() {
    await loadStats();
    await loadApprovalData();
  }

  /**
   * çµ±è¨ˆæƒ…å ±èª­ã¿è¾¼ã¿
   */
  async function loadStats() {
    try {
      const stats = await API.get('getAdminStats');
      
      document.getElementById('pendingTotal').textContent = stats.pendingTotal || 0;
      document.getElementById('pendingMembers').textContent = stats.pendingMembers || 0;
      document.getElementById('pendingClients').textContent = stats.pendingClients || 0;
      document.getElementById('pendingQuests').textContent = stats.pendingQuests || 0;
      document.getElementById('inProgress').textContent = stats.inProgress || 0;
      document.getElementById('completed').textContent = stats.completed || 0;
      document.getElementById('deposit').textContent = Utils.formatCurrency(stats.deposit || 0);
    } catch (error) {
      console.error('çµ±è¨ˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  /**
   * å¯©æŸ»ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
   */
  async function loadApprovalData() {
    try {
      const data = await API.get('getApprovalData');
      
      displayPendingMembers(data.members || []);
      displayPendingClients(data.clients || []);
      displayPendingQuests(data.quests || []);
    } catch (error) {
      console.error('å¯©æŸ»ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  /**
   * å¯©æŸ»å¾…ã¡ãƒ¡ãƒ³ãƒãƒ¼è¡¨ç¤º
   */
  function displayPendingMembers(members) {
    const container = document.getElementById('pendingMembersList');
    
    if (members.length === 0) {
      container.innerHTML = '<p class="no-data">å¯©æŸ»å¾…ã¡ã®ãƒ¡ãƒ³ãƒãƒ¼ã¯ã„ã¾ã›ã‚“</p>';
      return;
    }
    
    const table = `
      <table class="admin-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </th>
            <th>æ°å</th>
            <th>ãƒ¡ãƒ¼ãƒ«</th>
            <th>ç™»éŒ²æ—¥</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          ${members.map(m => `
            <tr>
              <td>${m.id}</td>
              <td>${m.nickname}</td>
              <td>${m.name}</td>
              <td>${m.email}</td>
              <td>${Utils.formatDate(m.registeredDate)}</td>
              <td>
                <button class="btn-approve" onclick="approveMember('${m.id}')">æ‰¿èª</button>
                <button class="btn-reject" onclick="rejectMember('${m.id}')">å´ä¸‹</button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
    
    container.innerHTML = table;
  }

  /**
   * å¯©æŸ»å¾…ã¡ä¾é ¼ä¸»è¡¨ç¤º
   */
  function displayPendingClients(clients) {
    const container = document.getElementById('pendingClientsList');
    
    if (clients.length === 0) {
      container.innerHTML = '<p class="no-data">å¯©æŸ»å¾…ã¡ã®ä¾é ¼ä¸»ã¯ã„ã¾ã›ã‚“</p>';
      return;
    }
    
    const table = `
      <table class="admin-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>ä¾é ¼ä¸»å</th>
            <th>ç¨®åˆ¥</th>
            <th>ãƒ¡ãƒ¼ãƒ«</th>
            <th>ç™»éŒ²æ—¥</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          ${clients.map(c => `
            <tr>
              <td>${c.id}</td>
              <td>${c.name}</td>
              <td>${c.type}</td>
              <td>${c.email}</td>
              <td>${Utils.formatDate(c.registeredDate)}</td>
              <td>
                <button class="btn-approve" onclick="approveClient('${c.id}')">æ‰¿èª</button>
                <button class="btn-reject" onclick="rejectClient('${c.id}')">å´ä¸‹</button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
    
    container.innerHTML = table;
  }

  /**
   * å¯©æŸ»å¾…ã¡ã‚¯ã‚¨ã‚¹ãƒˆè¡¨ç¤º
   */
  function displayPendingQuests(quests) {
    const container = document.getElementById('pendingQuestsList');
    
    if (quests.length === 0) {
      container.innerHTML = '<p class="no-data">å¯©æŸ»å¾…ã¡ã®ã‚¯ã‚¨ã‚¹ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“</p>';
      return;
    }
    
    const table = `
      <table class="admin-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
            <th>ä¾é ¼ä¸»ID</th>
            <th>å ±é…¬</th>
            <th>ç™»éŒ²æ—¥</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody>
          ${quests.map(q => `
            <tr>
              <td>${q.id}</td>
              <td>${q.title}</td>
              <td>${q.clientId}</td>
              <td>${Utils.formatCurrency(q.reward)}</td>
              <td>${Utils.formatDate(q.registeredDate)}</td>
              <td>
                <button class="btn-approve" onclick="approveQuest('${q.id}')">æ‰¿èª</button>
                <button class="btn-reject" onclick="rejectQuest('${q.id}')">å´ä¸‹</button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
    
    container.innerHTML = table;
  }

  /**
   * ãƒ¡ãƒ³ãƒãƒ¼æ‰¿èª
   */
  async function approveMember(id) {
    if (!confirm(`ãƒ¡ãƒ³ãƒãƒ¼ ${id} ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)) return;
    
    try {
      const result = await API.post('approve', { type: 'member', id: id });
      
      if (result.success) {
        Notification.success('ãƒ¡ãƒ³ãƒãƒ¼ã‚’æ‰¿èªã—ã¾ã—ãŸ');
        loadAllData();
      } else {
        Notification.error('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
      }
    } catch (error) {
      Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
  }

  /**
   * ãƒ¡ãƒ³ãƒãƒ¼å´ä¸‹
   */
  async function rejectMember(id) {
    const reason = prompt('å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
    if (!reason) return;
    
    try {
      const result = await API.post('reject', { type: 'member', id: id, reason: reason });
      
      if (result.success) {
        Notification.success('ãƒ¡ãƒ³ãƒãƒ¼ã‚’å´ä¸‹ã—ã¾ã—ãŸ');
        loadAllData();
      } else {
        Notification.error('å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
      }
    } catch (error) {
      Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
  }

  /**
   * ä¾é ¼ä¸»æ‰¿èª
   */
  async function approveClient(id) {
    if (!confirm(`ä¾é ¼ä¸» ${id} ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)) return;
    
    try {
      const result = await API.post('approve', { type: 'client', id: id });
      
      if (result.success) {
        Notification.success('ä¾é ¼ä¸»ã‚’æ‰¿èªã—ã¾ã—ãŸ');
        loadAllData();
      } else {
        Notification.error('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
      }
    } catch (error) {
      Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
  }

  /**
   * ä¾é ¼ä¸»å´ä¸‹
   */
  async function rejectClient(id) {
    const reason = prompt('å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
    if (!reason) return;
    
    try {
      const result = await API.post('reject', { type: 'client', id: id, reason: reason });
      
      if (result.success) {
        Notification.success('ä¾é ¼ä¸»ã‚’å´ä¸‹ã—ã¾ã—ãŸ');
        loadAllData();
      } else {
        Notification.error('å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
      }
    } catch (error) {
      Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
  }

  /**
   * ã‚¯ã‚¨ã‚¹ãƒˆæ‰¿èª
   */
  async function approveQuest(id) {
    if (!confirm(`ã‚¯ã‚¨ã‚¹ãƒˆ ${id} ã‚’æ‰¿èªã—ã¾ã™ã‹ï¼Ÿ`)) return;
    
    try {
      const result = await API.post('approve', { type: 'quest', id: id });
      
      if (result.success) {
        Notification.success('ã‚¯ã‚¨ã‚¹ãƒˆã‚’æ‰¿èªã—ã¾ã—ãŸ');
        loadAllData();
      } else {
        Notification.error('æ‰¿èªã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
      }
    } catch (error) {
      Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
  }

  /**
   * ã‚¯ã‚¨ã‚¹ãƒˆå´ä¸‹
   */
  async function rejectQuest(id) {
    const reason = prompt('å´ä¸‹ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„:');
    if (!reason) return;
    
    try {
      const result = await API.post('reject', { type: 'quest', id: id, reason: reason });
      
      if (result.success) {
        Notification.success('ã‚¯ã‚¨ã‚¹ãƒˆã‚’å´ä¸‹ã—ã¾ã—ãŸ');
        loadAllData();
      } else {
        Notification.error('å´ä¸‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
      }
    } catch (error) {
      Notification.error('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
  }

  /**
   * ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
   */
  function setupTabs() {
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const tab = btn.dataset.tab;
        
        // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        document.querySelectorAll('.tab-content').forEach(content => {
          content.style.display = 'none';
        });
        document.getElementById(`${tab}Tab`).style.display = 'block';
        
        // ã‚¿ãƒ–ã”ã¨ã®ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        switch(tab) {
          case 'quests':
            await loadAllQuests();
            break;
          case 'members':
            await loadAllMembers();
            break;
          case 'clients':
            await loadAllClients();
            break;
          case 'payment':
            await loadPaymentData();
            break;
          case 'reports':
            await loadReports();
            break;
        }
      });
    });
  }

  /**
   * å…¨ã‚¯ã‚¨ã‚¹ãƒˆèª­ã¿è¾¼ã¿
   */
  async function loadAllQuests() {
    try {
      const quests = await API.get('getAllQuests');
      // è¡¨ç¤ºå‡¦ç†ï¼ˆçœç•¥ï¼‰
    } catch (error) {
      console.error('ã‚¯ã‚¨ã‚¹ãƒˆèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  /**
   * å…¨ãƒ¡ãƒ³ãƒãƒ¼èª­ã¿è¾¼ã¿
   */
  async function loadAllMembers() {
    try {
      const members = await API.get('getAllMembers');
      // è¡¨ç¤ºå‡¦ç†ï¼ˆçœç•¥ï¼‰
    } catch (error) {
      console.error('ãƒ¡ãƒ³ãƒãƒ¼èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  /**
   * å…¨ä¾é ¼ä¸»èª­ã¿è¾¼ã¿
   */
  async function loadAllClients() {
    try {
      const clients = await API.get('getAllClients');
      // è¡¨ç¤ºå‡¦ç†ï¼ˆçœç•¥ï¼‰
    } catch (error) {
      console.error('ä¾é ¼ä¸»èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  /**
   * å ±é…¬ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
   */
  async function loadPaymentData() {
    try {
      const data = await API.get('getPaymentData');
      // è¡¨ç¤ºå‡¦ç†ï¼ˆçœç•¥ï¼‰
    } catch (error) {
      console.error('å ±é…¬ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }

  /**
   * å ±å‘Šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
   */
  async function loadReports() {
    try {
      const reports = await API.get('getReports');
      // è¡¨ç¤ºå‡¦ç†ï¼ˆçœç•¥ï¼‰
    } catch (error) {
      console.error('å ±å‘Šãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
  }
</script>
</body>
</html>
