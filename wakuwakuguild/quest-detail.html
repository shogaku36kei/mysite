<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¯ã‚¨ã‚¹ãƒˆè©³ç´° - ã‚ãã‚ãã‚®ãƒ«ãƒ‰</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>âš”ï¸ ã‚ãã‚ãã‚®ãƒ«ãƒ‰</h1>
      <nav>
        <a href="index.html">ã‚¯ã‚¨ã‚¹ãƒˆæ²ç¤ºæ¿</a>
        <a href="ranking.html">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
        <a href="member.html">ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²</a>
        <a href="client.html">ä¾é ¼ä¸»ç™»éŒ²</a>
        <a href="mypage.html">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="quest-detail-section">
      <div class="breadcrumb">
        <a href="index.html">ã‚¯ã‚¨ã‚¹ãƒˆæ²ç¤ºæ¿</a> &gt; <span>ã‚¯ã‚¨ã‚¹ãƒˆè©³ç´°</span>
      </div>

      <div id="questDetail" class="quest-detail-card">
        <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
      </div>

      <div class="action-section">
        <h3>ã“ã®ã‚¯ã‚¨ã‚¹ãƒˆã«æŒ‘æˆ¦ã™ã‚‹</h3>
        <div class="accept-form">
          <p>ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¡ãƒ³ãƒãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
          <div class="form-group">
            <label for="memberId">ãƒ¡ãƒ³ãƒãƒ¼ID</label>
            <input type="text" id="memberId" placeholder="ä¾‹: M0001">
          </div>
          <div class="form-group">
            <label for="acceptType">å—æ³¨ã‚¿ã‚¤ãƒ—</label>
            <select id="acceptType">
              <option value="å€‹äºº">å€‹äººã§å—æ³¨</option>
              <option value="ãƒ‘ãƒ¼ãƒ†ã‚£">ãƒ‘ãƒ¼ãƒ†ã‚£ã§å—æ³¨</option>
            </select>
          </div>
          <div class="form-group" id="partySelectGroup" style="display: none;">
            <label for="partyId">ãƒ‘ãƒ¼ãƒ†ã‚£ID</label>
            <input type="text" id="partyId" placeholder="ä¾‹: P0001">
          </div>
          <div class="form-group">
            <label for="message">å¿œå‹Ÿãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
            <textarea id="message" rows="4" placeholder="æ„æ°—è¾¼ã¿ã‚„è³ªå•ãªã©ã‚’ã”è¨˜å…¥ãã ã•ã„"></textarea>
          </div>
          <button onclick="acceptQuest()" class="btn-primary">ã“ã®ã‚¯ã‚¨ã‚¹ãƒˆã‚’å—æ³¨ã™ã‚‹</button>
        </div>
      </div>

      <div class="info-box">
        <h3>âš ï¸ å—æ³¨å‰ã®ç¢ºèªäº‹é …</h3>
        <ul>
          <li>ã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚’ã‚ˆãç¢ºèªã—ã¦ãã ã•ã„</li>
          <li>æ¨å¥¨ãƒ©ãƒ³ã‚¯æœªæº€ã§ã‚‚å—æ³¨å¯èƒ½ã§ã™ãŒã€é›£æ˜“åº¦ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„</li>
          <li>å—æ³¨å¾Œã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¯ãƒ©ãƒ³ã‚¯ãƒ€ã‚¦ãƒ³ã®å¯¾è±¡ã¨ãªã‚Šã¾ã™</li>
          <li>ä½œæ¥­å®Œäº†å¾Œã¯é€Ÿã‚„ã‹ã«å®Œäº†å ±å‘Šã‚’è¡Œã£ã¦ãã ã•ã„</li>
        </ul>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2026 ç·ç¤¾å¸‚ã‚®ãƒ«ãƒ‰äº‹å‹™å±€ | ã‚ãã‚ãã‚®ãƒ«ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</p>
  </footer>

  <script src="js/config.js"></script>
  <script>
    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ã‚¯ã‚¨ã‚¹ãƒˆIDã‚’å–å¾—
    const urlParams = new URLSearchParams(window.location.search);
    const questId = urlParams.get('id');

    window.addEventListener('DOMContentLoaded', () => {
      if (questId) {
        loadQuestDetail(questId);
      } else {
        document.getElementById('questDetail').innerHTML = 
          '<p class="error">ã‚¯ã‚¨ã‚¹ãƒˆIDãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>';
      }
    });

    async function loadQuestDetail(id) {
      try {
        const response = await fetch(`${GAS_WEB_APP_URL}?action=getQuestDetail&id=${id}`);
        const quest = await response.json();
        displayQuestDetail(quest);
      } catch (error) {
        console.error('ã‚¯ã‚¨ã‚¹ãƒˆè©³ç´°å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
        document.getElementById('questDetail').innerHTML = 
          '<p class="error">ã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
      }
    }

    function displayQuestDetail(quest) {
      const container = document.getElementById('questDetail');
      
      container.innerHTML = `
        <div class="quest-detail-header">
          <h2>${quest.title}</h2>
          <div class="quest-meta">
            <span class="difficulty-large">${quest.difficulty}</span>
            <span class="recommend-rank">æ¨å¥¨ãƒ©ãƒ³ã‚¯: ${quest.recommendRank}</span>
          </div>
        </div>

        <div class="quest-detail-body">
          <div class="detail-section">
            <h3>ğŸ“‹ ã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±</h3>
            <table class="detail-table">
              <tr>
                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                <td><span class="category-tag">${quest.category}</span></td>
              </tr>
              <tr>
                <th>å®Ÿæ–½å ´æ‰€</th>
                <td>${quest.location}</td>
              </tr>
              <tr>
                <th>å¸Œæœ›æ—¥æ™‚</th>
                <td>${quest.desiredDate}</td>
              </tr>
              <tr>
                <th>æ‰€è¦æ™‚é–“</th>
                <td>${quest.estimatedHours}</td>
              </tr>
              <tr>
                <th>å¿…è¦äººæ•°</th>
                <td>${quest.requiredMembers}å</td>
              </tr>
              <tr>
                <th>å ±é…¬</th>
                <td class="reward-amount">ğŸ’° ${quest.reward.toLocaleString()}å††ï¼ˆç¨è¾¼ï¼‰</td>
              </tr>
            </table>
          </div>

          <div class="detail-section">
            <h3>ğŸ“ å†…å®¹è©³ç´°</h3>
            <div class="description-box">
              ${quest.description.replace(/\n/g, '<br>')}
            </div>
          </div>

          ${quest.equipment ? `
          <div class="detail-section">
            <h3>ğŸ› ï¸ å¿…è¦ãªé“å…·ãƒ»è£…å‚™</h3>
            <div class="equipment-box">
              ${quest.equipment.replace(/\n/g, '<br>')}
            </div>
          </div>
          ` : ''}

          ${quest.notes ? `
          <div class="detail-section">
            <h3>âš ï¸ æ³¨æ„äº‹é …ãƒ»å‚™è€ƒ</h3>
            <div class="notes-box">
              ${quest.notes.replace(/\n/g, '<br>')}
            </div>
          </div>
          ` : ''}

          <div class="detail-section">
            <h3>ğŸ‘¤ ä¾é ¼ä¸»æƒ…å ±</h3>
            <p>ä¾é ¼ä¸»: ${quest.clientName || 'éå…¬é–‹'}</p>
            <p class="note">â€»è©³ç´°ãªé€£çµ¡å…ˆã¯å—æ³¨å¾Œã«é–‹ç¤ºã•ã‚Œã¾ã™</p>
          </div>

          <div class="detail-section">
            <h3>ğŸ–ï¸ ç²å¾—çµŒé¨“å€¤</h3>
            <p class="exp-info">ã“ã®ã‚¯ã‚¨ã‚¹ãƒˆã‚’å®Œäº†ã™ã‚‹ã¨ <strong>${getExpByDifficulty(quest.difficulty)} EXP</strong> ã‚’ç²å¾—ã§ãã¾ã™</p>
          </div>
        </div>
      `;
    }

    function getExpByDifficulty(difficulty) {
      const expTable = {
        'â˜…': 10,
        'â˜…â˜…': 20,
        'â˜…â˜…â˜…': 40,
        'â˜…â˜…â˜…â˜…': 70,
        'â˜…â˜…â˜…â˜…â˜…': 100
      };
      return expTable[difficulty] || 10;
    }

    // å—æ³¨ã‚¿ã‚¤ãƒ—å¤‰æ›´æ™‚ã®å‡¦ç†
    document.getElementById('acceptType')?.addEventListener('change', (e) => {
      const partyGroup = document.getElementById('partySelectGroup');
      if (e.target.value === 'ãƒ‘ãƒ¼ãƒ†ã‚£') {
        partyGroup.style.display = 'block';
      } else {
        partyGroup.style.display = 'none';
      }
    });

async function acceptQuest() {
  const memberId = document.getElementById('memberId').value;
  const acceptType = document.getElementById('acceptType').value;
  const message = document.getElementById('message').value;
  
  if (!memberId) {
    alert('ãƒ¡ãƒ³ãƒãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  let acceptorId = memberId;
  if (acceptType === 'ãƒ‘ãƒ¼ãƒ†ã‚£') {
    const partyId = document.getElementById('partyId').value;
    if (!partyId) {
      alert('ãƒ‘ãƒ¼ãƒ†ã‚£IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      return;
    }
    acceptorId = partyId;
  }

  try {
    const response = await fetch(GAS_WEB_APP_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'text/plain',
      },
      body: JSON.stringify({
        action: 'acceptQuest',
        questId: questId,
        acceptorId: acceptorId,
        acceptorType: acceptType,
        message: message
      })
    });

    const result = await response.json();
    
    if (result.success) {
      alert('ã‚¯ã‚¨ã‚¹ãƒˆã‚’å—æ³¨ã—ã¾ã—ãŸï¼\nãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰é€²æ—ã‚’ç¢ºèªã§ãã¾ã™ã€‚');
      window.location.href = 'mypage.html';
    } else {
      alert('å—æ³¨ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
    }
  } catch (error) {
    console.error('å—æ³¨ã‚¨ãƒ©ãƒ¼:', error);
    alert('å—æ³¨å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  }
}
  </script>
</body>
</html>
