<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ‘ãƒ¼ãƒ†ã‚£ç™»éŒ² - ã‚ãã‚ãã‚®ãƒ«ãƒ‰</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>âš”ï¸ ã‚ãã‚ãã‚®ãƒ«ãƒ‰</h1>
      <nav>
        <a href="index.html">ã‚¯ã‚¨ã‚¹ãƒˆæ²ç¤ºæ¿</a>
        <a href="ranking.html">ãƒ©ãƒ³ã‚­ãƒ³ã‚°</a>
        <a href="member.html">ãƒ¡ãƒ³ãƒãƒ¼ç™»éŒ²</a>
        <a href="client.html">ä¾é ¼ä¸»ç™»éŒ²</a>
        <a href="mypage.html">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="form-section">
      <h2>ğŸ‘¥ ãƒ‘ãƒ¼ãƒ†ã‚£ç™»éŒ²</h2>
      <p>ä»²é–“ã¨ä¸€ç·’ã«ã‚¯ã‚¨ã‚¹ãƒˆã«æŒ‘æˆ¦ã—ã‚ˆã†ï¼è¤‡æ•°äººã§å”åŠ›ã—ã¦ã‚ˆã‚Šå¤§ããªã‚¯ã‚¨ã‚¹ãƒˆã«æŒ‘ã‚ã¾ã™ã€‚</p>

      <form id="partyForm" onsubmit="submitPartyForm(event)">
        <div class="form-group">
          <label for="partyName">ãƒ‘ãƒ¼ãƒ†ã‚£å <span class="required">*</span></label>
          <input type="text" id="partyName" name="partyName" required placeholder="ä¾‹: è‰åˆˆã‚ŠéšŠ">
          <small>ä»–ã®ãƒ¡ãƒ³ãƒãƒ¼ã‚„ä¾é ¼ä¸»ã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰ã§ã™</small>
        </div>

        <div class="form-group">
          <label for="leaderId">ãƒªãƒ¼ãƒ€ãƒ¼ID <span class="required">*</span></label>
          <input type="text" id="leaderId" name="leaderId" required placeholder="ä¾‹: M0001">
          <small>ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒªãƒ¼ãƒ€ãƒ¼ã¨ãªã‚‹ãƒ¡ãƒ³ãƒãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</small>
        </div>

        <div class="form-group">
          <label>ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¡ãƒ³ãƒãƒ¼ <span class="required">*</span></label>
          <div id="memberList">
            <div class="member-input-row">
              <input type="text" name="member1" placeholder="ãƒ¡ãƒ³ãƒãƒ¼IDï¼ˆä¾‹: M0002ï¼‰" required>
              <button type="button" onclick="removeMemberRow(this)" class="btn-remove">å‰Šé™¤</button>
            </div>
          </div>
          <button type="button" onclick="addMemberRow()" class="btn-secondary">ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ </button>
          <small>ãƒªãƒ¼ãƒ€ãƒ¼ã‚’å«ã‚ã¦æœ€å¤§5åã¾ã§ç™»éŒ²ã§ãã¾ã™</small>
        </div>

        <div class="form-group">
          <label for="distributionMethod">å ±é…¬åˆ†é…æ–¹å¼ <span class="required">*</span></label>
          <select id="distributionMethod" name="distributionMethod" required>
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="å‡ç­‰">å‡ç­‰åˆ†é…ï¼ˆå…¨å“¡ã«åŒé¡ï¼‰</option>
            <option value="ãƒªãƒ¼ãƒ€ãƒ¼æŒ‡å®š">ãƒªãƒ¼ãƒ€ãƒ¼æŒ‡å®šï¼ˆä½œæ¥­å¾Œã«åˆ†é…ç‡ã‚’æ±ºå®šï¼‰</option>
            <option value="å€‹åˆ¥æŒ¯è¾¼">å€‹åˆ¥æŒ¯è¾¼ï¼ˆå„ãƒ¡ãƒ³ãƒãƒ¼ã®å£åº§ã«ç›´æ¥æŒ¯è¾¼ï¼‰</option>
          </select>
        </div>

        <div class="form-group" id="accountGroup">
          <label for="accountType">å ±é…¬æŒ¯è¾¼å…ˆ <span class="required">*</span></label>
          <select id="accountType" name="accountType" required>
            <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
            <option value="ãƒªãƒ¼ãƒ€ãƒ¼å£åº§">ãƒªãƒ¼ãƒ€ãƒ¼ã®ç™»éŒ²å£åº§ã‚’ä½¿ç”¨</option>
            <option value="ãƒ‘ãƒ¼ãƒ†ã‚£å°‚ç”¨å£åº§">ãƒ‘ãƒ¼ãƒ†ã‚£å°‚ç”¨å£åº§ã‚’ç™»éŒ²</option>
          </select>
        </div>

        <fieldset id="partyAccountFields" style="display: none;">
          <legend>ğŸ’³ ãƒ‘ãƒ¼ãƒ†ã‚£å°‚ç”¨å£åº§æƒ…å ±</legend>
          
          <div class="form-group">
            <label for="bankName">éŠ€è¡Œå <span class="required">*</span></label>
            <input type="text" id="bankName" name="bankName">
          </div>

          <div class="form-group">
            <label for="branchName">æ”¯åº—å <span class="required">*</span></label>
            <input type="text" id="branchName" name="branchName">
          </div>

          <div class="form-group">
            <label for="accountTypeDetail">å£åº§ç¨®åˆ¥ <span class="required">*</span></label>
            <select id="accountTypeDetail" name="accountTypeDetail">
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="æ™®é€š">æ™®é€š</option>
              <option value="å½“åº§">å½“åº§</option>
            </select>
          </div>

          <div class="form-group">
            <label for="accountNumber">å£åº§ç•ªå· <span class="required">*</span></label>
            <input type="text" id="accountNumber" name="accountNumber">
          </div>

          <div class="form-group">
            <label for="accountHolder">å£åº§åç¾©ï¼ˆã‚«ãƒŠï¼‰ <span class="required">*</span></label>
            <input type="text" id="accountHolder" name="accountHolder">
          </div>
        </fieldset>

        <div class="form-group">
          <label for="partyDescription">ãƒ‘ãƒ¼ãƒ†ã‚£ç´¹ä»‹</label>
          <textarea id="partyDescription" name="partyDescription" rows="4" placeholder="ãƒ‘ãƒ¼ãƒ†ã‚£ã®ç‰¹å¾´ã‚„å¾—æ„åˆ†é‡ãªã©ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„"></textarea>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" name="agree" required>
            ãƒ‘ãƒ¼ãƒ†ã‚£è¦ç´„ã«åŒæ„ã—ã¾ã™
          </label>
        </div>

        <button type="submit" class="btn-primary">ãƒ‘ãƒ¼ãƒ†ã‚£ç™»éŒ²ç”³è«‹</button>
      </form>

      <div class="info-box">
        <h3>ğŸ’¡ ãƒ‘ãƒ¼ãƒ†ã‚£ã«ã¤ã„ã¦</h3>
        <ul>
          <li>ãƒ‘ãƒ¼ãƒ†ã‚£ã¯2ã€œ5åã®ãƒ¡ãƒ³ãƒãƒ¼ã§æ§‹æˆã•ã‚Œã¾ã™</li>
          <li>ãƒªãƒ¼ãƒ€ãƒ¼ãŒãƒ‘ãƒ¼ãƒ†ã‚£ã‚’ä»£è¡¨ã—ã¦ã‚¯ã‚¨ã‚¹ãƒˆã‚’å—æ³¨ã—ã¾ã™</li>
          <li>å ±é…¬ã¯é¸æŠã—ãŸåˆ†é…æ–¹å¼ã«å¾“ã£ã¦æ”¯æ‰•ã‚ã‚Œã¾ã™</li>
          <li>ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒ©ãƒ³ã‚¯ã¯ãƒ¡ãƒ³ãƒãƒ¼ã®å¹³å‡ãƒ©ãƒ³ã‚¯ã§æ±ºã¾ã‚Šã¾ã™</li>
          <li>ç™»éŒ²ç”³è«‹å¾Œã€äº‹å‹™å±€ã®å¯©æŸ»ãŒã‚ã‚Šã¾ã™</li>
        </ul>
      </div>
    </section>
  </main>

  <footer>
    <p>&copy; 2026 ç·ç¤¾å¸‚ã‚®ãƒ«ãƒ‰äº‹å‹™å±€ | ã‚ãã‚ãã‚®ãƒ«ãƒ‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</p>
  </footer>

  <script src="js/config.js"></script>
  <script>
    let memberCount = 1;

    function addMemberRow() {
      if (memberCount >= 4) {
        alert('ãƒ¡ãƒ³ãƒãƒ¼ã¯æœ€å¤§4åï¼ˆãƒªãƒ¼ãƒ€ãƒ¼å«ã‚ã¦5åï¼‰ã¾ã§è¿½åŠ ã§ãã¾ã™');
        return;
      }
      
      memberCount++;
      const memberList = document.getElementById('memberList');
      const newRow = document.createElement('div');
      newRow.className = 'member-input-row';
      newRow.innerHTML = `
        <input type="text" name="member${memberCount}" placeholder="ãƒ¡ãƒ³ãƒãƒ¼IDï¼ˆä¾‹: M000${memberCount + 1}ï¼‰">
        <button type="button" onclick="removeMemberRow(this)" class="btn-remove">å‰Šé™¤</button>
      `;
      memberList.appendChild(newRow);
    }

    function removeMemberRow(button) {
      if (memberCount <= 1) {
        alert('æœ€ä½1åã®ãƒ¡ãƒ³ãƒãƒ¼ãŒå¿…è¦ã§ã™');
        return;
      }
      button.parentElement.remove();
      memberCount--;
    }

    // å£åº§ã‚¿ã‚¤ãƒ—å¤‰æ›´æ™‚ã®å‡¦ç†
    document.getElementById('accountType')?.addEventListener('change', (e) => {
      const partyAccountFields = document.getElementById('partyAccountFields');
      if (e.target.value === 'ãƒ‘ãƒ¼ãƒ†ã‚£å°‚ç”¨å£åº§') {
        partyAccountFields.style.display = 'block';
        // å¿…é ˆé …ç›®ã‚’æœ‰åŠ¹åŒ–
        partyAccountFields.querySelectorAll('input, select').forEach(el => {
          el.required = true;
        });
      } else {
        partyAccountFields.style.display = 'none';
        // å¿…é ˆé …ç›®ã‚’ç„¡åŠ¹åŒ–
        partyAccountFields.querySelectorAll('input, select').forEach(el => {
          el.required = false;
        });
      }
    });

async function submitPartyForm(event) {
  event.preventDefault();
  
  const clientId = document.getElementById('clientId').value;
  if (!clientId) {
    alert('ä¾é ¼ä¸»IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
    return;
  }

  const submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.textContent = 'é€ä¿¡ä¸­...';
  
  const formData = new FormData(event.target);
  
  // ãƒ¡ãƒ³ãƒãƒ¼IDã‚’åé›†
  const members = [formData.get('leaderId')];
  for (let i = 1; i <= memberCount; i++) {
    const memberId = formData.get(`member${i}`);
    if (memberId) {
      members.push(memberId);
    }
  }

  const partyData = {
    partyName: formData.get('partyName'),
    leaderId: formData.get('leaderId'),
    members: members.join(','),
    distributionMethod: formData.get('distributionMethod'),
    accountType: formData.get('accountType'),
    bankName: formData.get('bankName'),
    branchName: formData.get('branchName'),
    accountTypeDetail: formData.get('accountTypeDetail'),
    accountNumber: formData.get('accountNumber'),
    accountHolder: formData.get('accountHolder'),
    description: formData.get('partyDescription')
  };

  try {
    const response = await fetch(GAS_WEB_APP_URL, {
      method: 'POST',
      headers: {
        'Content-Type': 'text/plain',
      },
      body: JSON.stringify({
        action: 'registerParty',
        data: partyData
      })
    });

    const result = await response.json();
    
    if (result.success) {
      alert('ãƒ‘ãƒ¼ãƒ†ã‚£ç™»éŒ²ç”³è«‹ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚\näº‹å‹™å±€ã®å¯©æŸ»ã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚');
      event.target.reset();
      memberCount = 1;
      document.getElementById('memberList').innerHTML = `
        <div class="member-input-row">
          <input type="text" name="member1" placeholder="ãƒ¡ãƒ³ãƒãƒ¼IDï¼ˆä¾‹: M0002ï¼‰" required>
          <button type="button" onclick="removeMemberRow(this)" class="btn-remove">å‰Šé™¤</button>
        </div>
      `;
    } else {
      alert('ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
    }
  } catch (error) {
    console.error('ç™»éŒ²ã‚¨ãƒ©ãƒ¼:', error);
    alert('ç™»éŒ²å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'ãƒ‘ãƒ¼ãƒ†ã‚£ç™»éŒ²ç”³è«‹';
  }
}
    /**
 * æ—¥ä»˜ã‚’æ—¥æœ¬èªå½¢å¼ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
 */
function formatDate(dateString) {
  if (!dateString) return '-';
  
  try {
    const date = new Date(dateString);
    
    // ç„¡åŠ¹ãªæ—¥ä»˜ãƒã‚§ãƒƒã‚¯
    if (isNaN(date.getTime())) return '-';
    
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hour = String(date.getHours()).padStart(2, '0');
    const minute = String(date.getMinutes()).padStart(2, '0');
    
    return `${year}å¹´${month}æœˆ${day}æ—¥ ${hour}:${minute}`;
  } catch (error) {
    return '-';
  }
}

/**
 * æ—¥ä»˜ã®ã¿è¡¨ç¤ºï¼ˆæ™‚åˆ»ãªã—ï¼‰
 */
function formatDateOnly(dateString) {
  if (!dateString) return '-';
  
  try {
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return '-';
    
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    
    return `${year}å¹´${month}æœˆ${day}æ—¥`;
  } catch (error) {
    return '-';
  }
}

/**
 * ç›¸å¯¾æ™‚é–“è¡¨ç¤ºï¼ˆâ—‹æ—¥å‰ã€â—‹æ™‚é–“å‰ãªã©ï¼‰
 */
function formatRelativeTime(dateString) {
  if (!dateString) return '-';
  
  try {
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return '-';
    
    const now = new Date();
    const diffMs = now - date;
    const diffSec = Math.floor(diffMs / 1000);
    const diffMin = Math.floor(diffSec / 60);
    const diffHour = Math.floor(diffMin / 60);
    const diffDay = Math.floor(diffHour / 24);
    
    if (diffSec < 60) return `${diffSec}ç§’å‰`;
    if (diffMin < 60) return `${diffMin}åˆ†å‰`;
    if (diffHour < 24) return `${diffHour}æ™‚é–“å‰`;
    if (diffDay < 7) return `${diffDay}æ—¥å‰`;
    
    return formatDateOnly(dateString);
  } catch (error) {
    return '-';
  }
}
  </script>
</body>
</html>
